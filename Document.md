# Git・Githubチュートリアル

## はじめに

ここではgit/githubの使い方について説明していきます。
間違っている等ありましたら適宜修正お願いします。

## Git・Githubによるバージョン管理の概要

gitは分散型バージョン管理システムと呼ばれている

* 新旧のファイルを一元管理できる
* 編集した履歴を複数人で共有できる
* 複数人で修正した部分を一つに統合できる

などの利点があります。

### 基本的な流れ

まず準備として`git cloneコマンド`で自分のマシンにリポジトリを複製。

その後

1. ブランチを切る
2. ファイルを編集し、適宜add・commit
3. キリのいいところでリモートにpush
4. 2~3を繰り返す
5. 作業したブランチからmaster(main)ブランチへpull requestを出す
6. 他の人などとレビューし修正されればmaster(main)へマージする
7. 作業したブランチを削除

のようになります。
ここからgit関係の概念の説明をしていきます。

***

### リポジトリ

リポジトリとはファイルやディレクトリの状態を記録する場所のこと、またはそのファイル群を指します。

ユーザがそれぞれ自分のマシンに配置するリポジトリをローカルリポジトリ、サーバに配置して複数人で共有するリポジトリをリモートリポジトリと呼びます。

このリモートリポジトリを提供しているのがgithubというWebサービスです。普段の作業はローカルリポジトリで行い、ある程度作業したらリモートリポジトリに反映させ、共有するという使い方になります。<br>

***

### ワーキングツリーとインデックス

ユーザーのマシン内の作業しているディレクトリのことをワーキングツリー（ワークツリー・作業ツリー）といいます。作業場所であるワーキングツリーと保存場所であるローカルリポジトリの間にはインデックスという中間領域があります。
ワークツリーで編集したファイルをローカルリポジトリに反映（コミット）したい場合には、一度インデックスに登録（add）します。

インデックスに登録することをステージングと呼びます。編集した複数のファイルをインデックスに登録しておいてまとめてコミットします。

***

### ブランチ

ブランチとは並行してそれぞれが編集し、編集の履歴を分岐して記録（コミット）するためにgitに備わってる機能です。ブランチ周りのミスは多いので気をつけましょう。

まず、master（またはmainなど）ブランチという分岐元となり、いつでもリリース版が作成可能なようにしておくブランチがあります。（これを統合ブランチなどといいます。）

それに対し、統合ブランチから分岐しそれぞれがい機能追加やバグ修正などの作業するブランチをトピックブランチなどといいます。

開発用のトピックブランチで作業をし、統合ブランチに結合（merge)することで編集を反映させます。作業する際やpull、pushする際にはブランチ名が正しいか必ず確認してください。

ブランチをmergeする際にそれぞれが同じファイルを編集していた場合、コンフリクト（衝突）が起きます。コンフリクトを起こしたファイルの対象部分には以下のように表示されるので修正した上でadd・commit・pushしましょう。

```#bin/bash
<<<<<<< HEAD
# 作業ブランチでの変更内容
・・・
=======
# hoge(マージしたブランチ)での変更内容
・・・
>>>>>>> hoge
```

## 主要なコマンド

各種コマンドを説明します。

### 初期設定

ユーザー名・メールアドレス・エディタを設定します．エディタは任意ですがここではvscodeを指定ます，

```#bin/bash
git config --global user.name "hoge"
git config --global user.email "fuga"
git config --global core.editor 'code --wait'
```

にてアカウントの設定を行います。`hoge`や`fuga`のところには自分のgithubアカウントのusernameと登録したメールアドレスを入れましょう。この設定を行わないと権利関係のところで不具合が発生するので必ず行ってください。

### clone

自分のマシンのカレントディレクトリにリポジトリのクローンを作成します。githubのクローンしたいリポジトリのページの`code`という緑色のボタンを押してURLをコピーしたのちコマンドを使います。

```#bin/bash
git clone リポジトリのURL
git clone リポジトリのURL ディレクトリ名  //作るディレクトリを指定
```

### add

自分のワークツリーからインデックスにファイルの変更などをステージングする際のコマンドです。

```#bin/bash
git add ファイル名
git add ディレクトリ名
git add .             //カレントディレクトリ以下の変更したファイルを全てaddする
```

のように使います。

### commit

インデックスにステージングされた変更をリポジトリに記録するコマンドです。

`git commit -m "コミットメッセージ"`

のように使います。`-m`はターミナル（コマンドプロンプト）上でコミットメッセージを打ち込むためのものでこれを書かないとエディターが開かれてしまいます。コミットメッセージはどのような修正・追記をしたのかわかりやすく書くと良いです。

また、commitを修正したい場合、**pushする前に限り**修正を行うことができます。

`git commit --amend -m "コミットメッセージ"`

のようにすることで修正を行うことができます。コミットメッセージを修正したい場合、addし忘れたファイルがある場合などに用いましょう。

### push

ローカルリポジトリの変更をリモートリポジトリに送るコマンドです。

`git push リモート名 ブランチ名`

例えば、`git push origin hoge`だと現在のローカルのブランチを`origin`というリモートリポジトリの`hoge`ブランチに反映させます。現在いるローカルブランチ名とpushするブランチ名をよく確認した上でpushしましょう。

### fetch

リモートリポジトリからローカルリポジトリへ情報を送るコマンドです。

注意するのは反映されるブランチはmasterではなく`remotes/リモート名/ブランチ名`となることです。

`git fetch リモート名`

というように使います。
例えば`git fetch origin`とすると`remotes/origin/master`ブランチが作成されます。次で説明する`merge`とあわせて使うことが多いでしょう。

### merge

あるブランチの内容を **今いるブランチに** 反映させるコマンドです。

`git merge ブランチ名`

のように使います。例えば`git checkout master`をした後に`git merge hoge`とすることで、hogeブランチの内容をmasterに反映させることができます。競合（コンフリクト）などが起きない場合、直ちに反映されます。競合している場合は差分などが表示されるのでその都度解消しましょう。

### pull

リモートのあるブランチの内容をローカルの **今いるブランチに** 反映させるコマンドです。

`git pull リモート名 ブランチ名`

として使います。fetchとmergeを同時に行うようなイメージです。

例えば`git pull origin master`は

```#bin/bash
git fetch origin master
git merge origin/master
```

をするのと同じことです。今いるブランチにpullされることに注意してください。

### checkout

主にブランチを切り替えるコマンドです。

```#bin/bash
git checkout ブランチ名
git checkout -b ブランチ名　//新しくブランチを作った上で移動
```

もう一つの役割が特定のコミットにおけるファイルを現在のワーキングツリーに展開することです。手元にある同じ名前のファイルを以前のコミットから展開すればファイルの変更を元に戻すことが可能です。

`git checkout コミットのハッシュ値 ファイル名`

のように使います。`コミットのハッシュ値`の部分は`HEAD`なども使用可能です。

### branch

現在あるブランチと現在いるブランチを確認したり、新しくブランチを作成したりします。

```#bin/bash
git branch  //現在あるブランチを確認
git branch ブランチ名  //新しくブランチを作成
```

branchコマンドで作成してもブランチの移動は行われないので注意しましょう。作成して移動したい場合は`checkout -b`を使いましょう。

### reset

addやcommitを元に戻すコマンドです。戻りたいコミットや影響を与えたい範囲を指定して元に戻します。

`HEAD`は最新のコミットを表し、`HEAD~`は一つ前のコミットを表します。（エイリアスになっています。）

```#bin/bash
git reset HEAD
git reset HEAD ファイル名
```

では最新のコミットに戻るので、addを取り消すことに相当します。また、

```#bin/bash
git reset --hard HEAD~
　　//HEADの位置・インデックス・ワーキングツリー全てを戻す
git reset --mixed HEAD~
　　//HEADの位置・インデックスを戻す
git reset --soft HEAD~
　　//HEADの位置を戻す
```

HEAD~は一つ前のコミットを表すので、commitを取り消すことに相当します。その際にaddも取り消すか、ワーキングツリーも元に戻すかをオプションで選択できます。

### status

変更状況を確認するコマンドです。ファイルの変更がaddされているか、変更がcommitされているか確認できます。

`git status`

のように使います。便利ですので適宜使用して確認しましょう。

### diff

変更の差分を確認するコマンドです。

addする前の差分は`git diff`

addした後の差分は`git diff --staged`で確認できます。

### stash

変更を退避させるコマンドです。あるブランチで作業していて、他のブランチで作業したくなったが中途半端なのでコミットはしたくない時に使います。

```#bi/bash
git stash save
または
git stash
```

でコミットしたいない変更が退避されます。また、以下のコマンドで退避を確認したり元に戻したりできます。stash名の部分はstash@{0}のような形式です。

```#bin/bash
git stash list  //退避した作業を確認
git stash apply stash名  //stash名を現在いるブランチへ元にもどす
git stash drop stash名  //退避したstash名を削除
git stash clear //退避した作業を全て削除
```

### log

変更履歴を確認するコマンドです。

```#bin/bash
git log
git log --oneline　//一行で表示
git log -p ファイル名　//ファイルの変更履歴を表示
git log -n コミット数　//最新のコミットから指定したコミット数分遡って表示
```

のように使います。

### rm

ファイルの削除を記録するコマンドです。

```#bin/bash
git rm ファイル名　//ワークツリーから削除する場合
git rm --cached ファイル名　//ワークツリーには残す場合
```

`--cached`はパスワードなどを誤ってコミットしたときなどに用います。パスワード等は`.gitignore`を活用しましょう。
